---
- name: Git CityData
  git:
    repo: '{{ repo_url }}'
    dest: '~/{{ project_dir }}'

- name: Prepare the stack (without running) 1/2
  # docker_service:
  #   project_src: '~/{{ project_dir }}'
  #   pull: yes
  command: docker-compose -f docker-compose.yml pull --no-parallel
  args:
    chdir: '{{ ansible_env.HOME }}/{{ project_dir }}'
  become: true

- name: Prepare the stack (without running) 2/2
  command: docker-compose -f docker-compose.yml up --no-start
  args:
    chdir: '{{ ansible_env.HOME }}/{{ project_dir }}'
  become: true

- name: Start the database
  command: docker-compose -f docker-compose.yml up -d postgres
  args:
    chdir: '{{ ansible_env.HOME }}/{{ project_dir }}'
  become: true
